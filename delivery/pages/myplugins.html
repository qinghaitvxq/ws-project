<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <!--<script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>-->
    <script src="http://libs.baidu.com/jquery/1.8.3/jquery.min.js"></script>
    <link rel="stylesheet" href="../style/bootstrap.css">
    <link rel="stylesheet" href="../style/main.css">
    <link rel="stylesheet" href="../style/weebox.css">

    <script src="../scripts/flow_tree.js"></script>
    <script src="../scripts/bgiframe.js"></script>
    <script src="../scripts/weebox.js"></script>

    <style>
    .out_div{
        width:50%;
        margin:20px auto;
    }
</style>
    <script>
        $(document).ready(function () {
         $("#flowtree").flowtree();
         $("#flowtree_new").flowtree();


         $("#btn_test").click(function () {
             $.weeboxs.open("操作成功",{title:'提示',type:'alert'});
         });

         //流程节点构造函数
         function flowNode() {
             this.title="";
             this.content="";
             this.childrenNodes=[];
             this.index="";
             //this.parent="";
         }
         //获取thisobj流程节点输入值
         function getNodeValue(thisobj) {
             this.title=$(thisobj).find("input.form-control").val();
             this.content=$(thisobj).find("textarea.form-control").val();
         }

         $("#getjson").click(function () {
             var nodeList=[];

             var control=$("#flowtree");

             //一级节点
             var firstNodes=control.children("li");
             firstNodes.each(function (index) {
                var firstNode=new flowNode();
                getNodeValue.apply(firstNode,[this]);
                firstNode.index="f_"+index;
                nodeList.push(firstNode);

                //二级节点
                 var secondNodes=$(this).children("ul").children("li");
                 secondNodes.each(function (index) {
                    var secondNode=new flowNode();
                    getNodeValue.apply(secondNode,[this]);
                    secondNode.parent=firstNode.index;
                    secondNode.index="s_"+index;
                    firstNode.childrenNodes.push(secondNode);

                     //三级节点
                     var thirdNodes=$(this).children("ul").children("li");
                     thirdNodes.each(function (index) {
                         var thirdNode=new flowNode();
                         getNodeValue.apply(thirdNode,[this]);
                         thirdNode.parent=secondNode.index;
                         thirdNode.index="t_"+index;
                         secondNode.childrenNodes.push(thirdNode);
                     });

                 });

             });
             var jsoncontent=JSON.stringify(nodeList, null, 4);
             var html = jsoncontent.replace(/\n/g, '<br>').replace(/\s/g, '&nbsp');
             $("#divjson").html(JSON.stringify(html, null, 4));

         });


        });
    </script>


</head>
<body>
<!-- Large modal -->
<p>弹框测试</p>
<input type="button"  id="btn_test" value="点我弹出框">
<!--<p>新增</p>-->
<!--<div class="new-flow-form out_div">-->
    <!--<div class="form-group">-->
        <!--<ul id="flowtree_new">-->

        <!--</ul>-->
    <!--</div>-->
<!--</div>-->

<p>编辑</p>

<div class="new-flow-form out_div">

    <div class="form-group">

        <ul id="flowtree" >
            <li >
                <div >
                    <input  class="form-control" placeholder="节点名称"  value="hehhahahe">
                    <textarea class="form-control" rows="3" placeholder="节点解释说明">haha</textarea>
                </div>
                <ul>
                    <li >
                        <div>
                            <input  class="form-control" value="test" >
                            <textarea class="form-control" rows="3" >test desc</textarea>
                        </div>
                        <ul>
                            <li>
                                <div >
                                    <input  class="form-control"  value="hello">
                                    <textarea class="form-control" rows="3" > hello desc</textarea>
                                </div>
                            </li>
                        </ul>
                    </li>
                    <li  >
                        <div >

                            <input  class="form-control"  value="hi">
                            <textarea class="form-control" rows="3" >hi desc</textarea>
                        </div>
                        <ul>
                            <li>
                                <div >

                                    <input  class="form-control" value="keep" >
                                    <textarea class="form-control" rows="3" > keep going</textarea>
                                </div>
                            </li>
                        </ul>
                    </li>
                </ul>
            </li>

        </ul>

    </div>

</div>

<input type="button" id="getjson" value="获取流程JSON">
<div id="divjson" style="border:solid 1px rgb(118,199,193);min-height:500px;width:100%; margin: 10px; padding: 15px">
</div>

</div>
</body>
</html>